

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Baseball &mdash; NumPyro Tutorials 0.3.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/pyro.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-dataframe.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Bayesian Neural Network" href="bnn.html" />
    <link rel="prev" title="Code Examples" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> NumPyro Tutorials
          

          
            
            <img src="../_static/pyro_logo_wide.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Tutorials:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../bayesian_regression.html">Bayesian Regression Using NumPyro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../time_series_forecasting.html">Time Series Forecasting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bayesian_imputation.html">Bayesian Imputation</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Code Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Baseball</a></li>
<li class="toctree-l2"><a class="reference internal" href="bnn.html">Bayesian Neural Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="funnel.html">Neal’s Funnel</a></li>
<li class="toctree-l2"><a class="reference internal" href="gp.html">Gaussian Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="ucbadmit.html">Generalized Linear Mixed Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="hmm.html">Hidden Markov Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="neutra.html">Neural Transport</a></li>
<li class="toctree-l2"><a class="reference internal" href="ode.html">Predator-Prey Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="sparse_regression.html">Sparse Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="stochastic_volatility.html">Stochastic Volatility</a></li>
<li class="toctree-l2"><a class="reference internal" href="vae.html">Variational Autoencoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotation.html">Bayesian Models of Annotation</a></li>
<li class="toctree-l2"><a class="reference internal" href="hmm_enum.html">Enumerate Hidden Markov Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="proportion_test.html">Proportion Test</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NumPyro Tutorials</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Code Examples</a> &raquo;</li>
        
      <li>Baseball</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/examples/baseball.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-examples-baseball-py"><span class="std std-ref">here</span></a>     to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="baseball">
<span id="sphx-glr-examples-baseball-py"></span><h1>Baseball<a class="headerlink" href="#baseball" title="Permalink to this headline">¶</a></h1>
<p>Original example from Pyro:
<a class="reference external" href="https://github.com/pyro-ppl/pyro/blob/dev/examples/baseball.py">https://github.com/pyro-ppl/pyro/blob/dev/examples/baseball.py</a></p>
<p>Example has been adapted from [1]. It demonstrates how to do Bayesian inference using
various MCMC kernels in Pyro (HMC, NUTS, SA), and use of some common inference utilities.</p>
<p>As in the Stan tutorial, this uses the small baseball dataset of Efron and Morris [2]
to estimate players’ batting average which is the fraction of times a player got a
base hit out of the number of times they went up at bat.</p>
<p>The dataset separates the initial 45 at-bats statistics from the remaining season.
We use the hits data from the initial 45 at-bats to estimate the batting average
for each player. We then use the remaining season’s data to validate the predictions
from our models.</p>
<p>Three models are evaluated:</p>
<blockquote>
<div><ul class="simple">
<li><p>Complete pooling model: The success probability of scoring a hit is shared
amongst all players.</p></li>
<li><p>No pooling model: Each individual player’s success probability is distinct and
there is no data sharing amongst players.</p></li>
<li><p>Partial pooling model: A hierarchical model with partial data sharing.</p></li>
</ul>
</div></blockquote>
<p>We recommend Radford Neal’s tutorial on HMC ([3]) to users who would like to get a
more comprehensive understanding of HMC and its variants, and to [4] for details on
the No U-Turn Sampler, which provides an efficient and automated way (i.e. limited
hyper-parameters) of running HMC on different problems.</p>
<p>Note that the Sample Adaptive (SA) kernel, which is implemented based on [5],
requires large <cite>num_warmup</cite> and <cite>num_samples</cite> (e.g. 15,000 and 300,000). So
it is better to disable progress bar to avoid dispatching overhead.</p>
<p><strong>References:</strong></p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Carpenter B. (2016), <a class="reference external" href="http://mc-stan.org/users/documentation/case-studies/pool-binary-trials.html/">“Hierarchical Partial Pooling for Repeated Binary Trials”</a>.</p></li>
<li><p>Efron B., Morris C. (1975), “Data analysis using Stein’s estimator and its
generalizations”, J. Amer. Statist. Assoc., 70, 311-319.</p></li>
<li><p>Neal, R. (2012), “MCMC using Hamiltonian Dynamics”,
(<a class="reference external" href="https://arxiv.org/pdf/1206.1901.pdf">https://arxiv.org/pdf/1206.1901.pdf</a>)</p></li>
<li><p>Hoffman, M. D. and Gelman, A. (2014), “The No-U-turn sampler: Adaptively setting
path lengths in Hamiltonian Monte Carlo”, (<a class="reference external" href="https://arxiv.org/abs/1111.4246">https://arxiv.org/abs/1111.4246</a>)</p></li>
<li><p>Michael Zhu (2019), “Sample Adaptive MCMC”,
(<a class="reference external" href="https://papers.nips.cc/paper/9107-sample-adaptive-mcmc">https://papers.nips.cc/paper/9107-sample-adaptive-mcmc</a>)</p></li>
</ol>
</div></blockquote>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Downloading - https://d2hg8soec8ck9v.cloudfront.net/datasets/EfronMorrisBB.txt.
Download complete.

 ==============================fully_pooled - TRAIN==============================

                        At-bats ActualHits  Pred(p25)  Pred(p50)  Pred(p75)
    Roberto Clemente         45         18      10.00      12.00      14.00

      Frank Robinson         45         17      10.00      12.00      14.00

        Frank Howard         45         16      10.00      12.00      14.00

       Jay Johnstone         45         15      10.00      12.00      14.00

           Ken Berry         45         14      10.00      12.00      14.00

         Jim Spencer         45         14      10.00      12.00      14.00

       Don Kessinger         45         13      10.00      12.00      14.00

       Luis Alvarado         45         12      10.00      12.00      14.00

           Ron Santo         45         11      10.00      12.00      14.00

         Ron Swaboda         45         11      10.00      12.00      14.00

     Rico Petrocelli         45         10      10.00      12.00      14.00

     Ellie Rodriguez         45         10      10.00      12.00      14.00

        George Scott         45         10      10.00      12.00      14.00

           Del Unser         45         10      10.00      12.00      14.00

      Billy Williams         45         10      10.00      12.00      14.00

     Bert Campaneris         45          9      10.00      12.00      14.00

      Thurman Munson         45          8      10.00      12.00      14.00

           Max Alvis         45          7      10.00      12.00      14.00


 ==============================fully_pooled - TEST==============================

                        At-bats ActualHits  Pred(p25)  Pred(p50)  Pred(p75)
    Roberto Clemente        412        145     102.00     110.00     117.00

      Frank Robinson        471        144     117.00     125.00     133.00

        Frank Howard        566        160     142.00     151.00     160.00

       Jay Johnstone        320         76      78.00      85.00      92.00

           Ken Berry        463        128     115.00     123.00     131.00

         Jim Spencer        511        140     127.00     136.00     144.00

       Don Kessinger        631        168     158.00     167.00     178.00

       Luis Alvarado        183         41      44.00      49.00      53.00

           Ron Santo        555        148     138.00     148.00     157.00

         Ron Swaboda        245         57      60.00      65.00      71.00

     Rico Petrocelli        583        152     146.00     155.00     165.00

     Ellie Rodriguez        231         52      56.00      61.00      67.00

        George Scott        480        142     120.00     127.00     136.00

           Del Unser        322         83      79.00      85.00      92.00

      Billy Williams        636        205     159.00     170.00     179.00

     Bert Campaneris        603        168     151.00     160.00     170.00

      Thurman Munson        453        137     113.00     121.00     129.00

           Max Alvis        115         21      27.00      31.00      34.00


Log pointwise predictive density: -74.77


 ==============================not_pooled - TRAIN==============================

                        At-bats ActualHits  Pred(p25)  Pred(p50)  Pred(p75)
    Roberto Clemente         45         18      15.00      18.00      21.00

      Frank Robinson         45         17      14.00      17.00      20.00

        Frank Howard         45         16      13.00      16.00      19.00

       Jay Johnstone         45         15      12.00      15.00      18.00

           Ken Berry         45         14      11.00      14.00      17.00

         Jim Spencer         45         14      11.00      14.00      17.00

       Don Kessinger         45         13      10.00      13.00      16.00

       Luis Alvarado         45         12       9.00      12.00      15.00

           Ron Santo         45         11       9.00      11.00      14.00

         Ron Swaboda         45         11       8.00      11.00      14.00

     Rico Petrocelli         45         10       8.00      10.00      13.00

     Ellie Rodriguez         45         10       8.00      10.00      13.00

        George Scott         45         10       8.00      10.00      13.00

           Del Unser         45         10       8.00      10.00      13.00

      Billy Williams         45         10       8.00      10.00      13.00

     Bert Campaneris         45          9       7.00       9.00      12.00

      Thurman Munson         45          8       6.00       8.00      11.00

           Max Alvis         45          7       5.00       7.00      10.00


 ==============================not_pooled - TEST==============================

                        At-bats ActualHits  Pred(p25)  Pred(p50)  Pred(p75)
    Roberto Clemente        412        145     146.00     166.00     187.00

      Frank Robinson        471        144     156.00     180.00     205.00

        Frank Howard        566        160     176.00     203.00     231.00

       Jay Johnstone        320         76      93.00     108.00     124.00

           Ken Berry        463        128     125.00     146.00     170.00

         Jim Spencer        511        140     138.00     162.00     187.00

       Don Kessinger        631        168     158.00     187.00     216.00

       Luis Alvarado        183         41      41.00      50.00      59.00

           Ron Santo        555        148     117.00     140.00     165.00

         Ron Swaboda        245         57      50.00      61.00      73.00

     Rico Petrocelli        583        152     110.00     134.00     160.00

     Ellie Rodriguez        231         52      42.00      53.00      64.00

        George Scott        480        142      91.00     111.00     133.00

           Del Unser        322         83      60.00      74.00      89.00

      Billy Williams        636        205     120.00     145.00     173.00

     Bert Campaneris        603        168     102.00     125.00     152.00

      Thurman Munson        453        137      68.00      85.00     104.00

           Max Alvis        115         21      14.00      19.00      24.00


Log pointwise predictive density: -82.75


 ==============================partially_pooled - TRAIN==============================

                        At-bats ActualHits  Pred(p25)  Pred(p50)  Pred(p75)
    Roberto Clemente         45         18      12.00      14.00      17.00

      Frank Robinson         45         17      11.00      14.00      17.00

        Frank Howard         45         16      11.00      14.00      16.00

       Jay Johnstone         45         15      11.00      13.00      16.00

           Ken Berry         45         14      10.00      13.00      15.00

         Jim Spencer         45         14      10.00      13.00      15.00

       Don Kessinger         45         13      10.00      12.00      15.00

       Luis Alvarado         45         12      10.00      12.00      14.00

           Ron Santo         45         11       9.00      11.00      14.00

         Ron Swaboda         45         11       9.00      11.00      14.00

     Rico Petrocelli         45         10       9.00      11.00      13.00

     Ellie Rodriguez         45         10       9.00      11.00      13.00

        George Scott         45         10       9.00      11.00      13.00

           Del Unser         45         10       9.00      11.00      13.00

      Billy Williams         45         10       9.00      11.00      13.00

     Bert Campaneris         45          9       8.00      11.00      13.00

      Thurman Munson         45          8       8.00      10.00      13.00

           Max Alvis         45          7       8.00      10.00      12.00


 ==============================partially_pooled - TEST==============================

                        At-bats ActualHits  Pred(p25)  Pred(p50)  Pred(p75)
    Roberto Clemente        412        145     116.00     131.00     147.00

      Frank Robinson        471        144     130.00     145.00     162.00

        Frank Howard        566        160     151.00     171.00     192.00

       Jay Johnstone        320         76      83.00      93.00     104.00

           Ken Berry        463        128     116.00     131.00     147.00

         Jim Spencer        511        140     129.00     145.00     162.00

       Don Kessinger        631        168     154.00     173.00     193.00

       Luis Alvarado        183         41      42.00      49.00      56.00

           Ron Santo        555        148     126.00     143.00     161.00

         Ron Swaboda        245         57      54.00      63.00      71.00

     Rico Petrocelli        583        152     128.00     145.00     163.00

     Ellie Rodriguez        231         52      50.00      58.00      65.00

        George Scott        480        142     103.00     119.00     134.00

           Del Unser        322         83      69.00      80.00      90.00

      Billy Williams        636        205     138.75     159.00     178.00

     Bert Campaneris        603        168     126.00     145.00     164.00

      Thurman Munson        453        137      90.00     106.00     120.00

           Max Alvis        115         21      21.00      25.00      30.00


Log pointwise predictive density: -74.96


 ==============================partially_pooled_with_logit - TRAIN==============================

                        At-bats ActualHits  Pred(p25)  Pred(p50)  Pred(p75)
    Roberto Clemente         45         18      11.00      13.00      15.00

      Frank Robinson         45         17      10.00      13.00      15.00

        Frank Howard         45         16      10.00      12.00      15.00

       Jay Johnstone         45         15      10.00      12.00      15.00

           Ken Berry         45         14      10.00      12.00      15.00

         Jim Spencer         45         14      10.00      12.00      15.00

       Don Kessinger         45         13      10.00      12.00      14.00

       Luis Alvarado         45         12      10.00      12.00      14.00

           Ron Santo         45         11       9.00      12.00      14.00

         Ron Swaboda         45         11       9.00      12.00      14.00

     Rico Petrocelli         45         10       9.00      11.00      14.00

     Ellie Rodriguez         45         10       9.00      11.00      14.00

        George Scott         45         10       9.00      11.00      14.00

           Del Unser         45         10       9.00      11.00      14.00

      Billy Williams         45         10       9.00      11.00      14.00

     Bert Campaneris         45          9       9.00      11.00      13.00

      Thurman Munson         45          8       9.00      11.00      13.00

           Max Alvis         45          7       9.00      11.00      13.00


 ==============================partially_pooled_with_logit - TEST==============================

                        At-bats ActualHits  Pred(p25)  Pred(p50)  Pred(p75)
    Roberto Clemente        412        145     107.00     118.00     132.00

      Frank Robinson        471        144     122.00     133.00     147.00

        Frank Howard        566        160     145.00     158.00     173.00

       Jay Johnstone        320         76      80.00      88.00      97.00

           Ken Berry        463        128     114.00     126.00     138.00

         Jim Spencer        511        140     127.00     140.00     152.00

       Don Kessinger        631        168     154.00     169.00     184.00

       Luis Alvarado        183         41      43.00      48.00      54.00

           Ron Santo        555        148     131.00     145.00     158.00

         Ron Swaboda        245         57      57.00      64.00      71.00

     Rico Petrocelli        583        152     136.00     150.00     163.00

     Ellie Rodriguez        231         52      52.00      59.00      66.00

        George Scott        480        142     110.00     123.00     136.00

           Del Unser        322         83      74.00      83.00      91.00

      Billy Williams        636        205     149.00     164.00     179.00

     Bert Campaneris        603        168     137.00     153.00     168.00

      Thurman Munson        453        137     100.00     114.00     125.00

           Max Alvis        115         21      24.00      28.00      32.00


Log pointwise predictive density: -72.79
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="kn">import</span> <span class="nn">jax.random</span> <span class="k">as</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">jax.scipy.special</span> <span class="kn">import</span> <span class="n">logsumexp</span>

<span class="kn">import</span> <span class="nn">numpyro</span>
<span class="kn">import</span> <span class="nn">numpyro.distributions</span> <span class="k">as</span> <span class="nn">dist</span>
<span class="kn">from</span> <span class="nn">numpyro.examples.datasets</span> <span class="kn">import</span> <span class="n">BASEBALL</span><span class="p">,</span> <span class="n">load_dataset</span>
<span class="kn">from</span> <span class="nn">numpyro.infer</span> <span class="kn">import</span> <span class="n">HMC</span><span class="p">,</span> <span class="n">MCMC</span><span class="p">,</span> <span class="n">NUTS</span><span class="p">,</span> <span class="n">SA</span><span class="p">,</span> <span class="n">Predictive</span><span class="p">,</span> <span class="n">log_likelihood</span>


<span class="k">def</span> <span class="nf">fully_pooled</span><span class="p">(</span><span class="n">at_bats</span><span class="p">,</span> <span class="n">hits</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Number of hits in $K$ at bats for each player has a Binomial</span>
<span class="sd">    distribution with a common probability of success, $\phi$.</span>

<span class="sd">    :param (jnp.DeviceArray) at_bats: Number of at bats for each player.</span>
<span class="sd">    :param (jnp.DeviceArray) hits: Number of hits for the given at bats.</span>
<span class="sd">    :return: Number of hits predicted by the model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">phi_prior</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;phi&quot;</span><span class="p">,</span> <span class="n">phi_prior</span><span class="p">)</span>
    <span class="n">num_players</span> <span class="o">=</span> <span class="n">at_bats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">plate</span><span class="p">(</span><span class="s2">&quot;num_players&quot;</span><span class="p">,</span> <span class="n">num_players</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Binomial</span><span class="p">(</span><span class="n">at_bats</span><span class="p">,</span> <span class="n">probs</span><span class="o">=</span><span class="n">phi</span><span class="p">),</span> <span class="n">obs</span><span class="o">=</span><span class="n">hits</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">not_pooled</span><span class="p">(</span><span class="n">at_bats</span><span class="p">,</span> <span class="n">hits</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Number of hits in $K$ at bats for each player has a Binomial</span>
<span class="sd">    distribution with independent probability of success, $\phi_i$.</span>

<span class="sd">    :param (jnp.DeviceArray) at_bats: Number of at bats for each player.</span>
<span class="sd">    :param (jnp.DeviceArray) hits: Number of hits for the given at bats.</span>
<span class="sd">    :return: Number of hits predicted by the model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_players</span> <span class="o">=</span> <span class="n">at_bats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">plate</span><span class="p">(</span><span class="s2">&quot;num_players&quot;</span><span class="p">,</span> <span class="n">num_players</span><span class="p">):</span>
        <span class="n">phi_prior</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;phi&quot;</span><span class="p">,</span> <span class="n">phi_prior</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Binomial</span><span class="p">(</span><span class="n">at_bats</span><span class="p">,</span> <span class="n">probs</span><span class="o">=</span><span class="n">phi</span><span class="p">),</span> <span class="n">obs</span><span class="o">=</span><span class="n">hits</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">partially_pooled</span><span class="p">(</span><span class="n">at_bats</span><span class="p">,</span> <span class="n">hits</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Number of hits has a Binomial distribution with independent</span>
<span class="sd">    probability of success, $\phi_i$. Each $\phi_i$ follows a Beta</span>
<span class="sd">    distribution with concentration parameters $c_1$ and $c_2$, where</span>
<span class="sd">    $c_1 = m * kappa$, $c_2 = (1 - m) * kappa$, $m ~ Uniform(0, 1)$,</span>
<span class="sd">    and $kappa ~ Pareto(1, 1.5)$.</span>

<span class="sd">    :param (jnp.DeviceArray) at_bats: Number of at bats for each player.</span>
<span class="sd">    :param (jnp.DeviceArray) hits: Number of hits for the given at bats.</span>
<span class="sd">    :return: Number of hits predicted by the model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">kappa</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;kappa&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Pareto</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">))</span>
    <span class="n">num_players</span> <span class="o">=</span> <span class="n">at_bats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">plate</span><span class="p">(</span><span class="s2">&quot;num_players&quot;</span><span class="p">,</span> <span class="n">num_players</span><span class="p">):</span>
        <span class="n">phi_prior</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">Beta</span><span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">kappa</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="n">kappa</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;phi&quot;</span><span class="p">,</span> <span class="n">phi_prior</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Binomial</span><span class="p">(</span><span class="n">at_bats</span><span class="p">,</span> <span class="n">probs</span><span class="o">=</span><span class="n">phi</span><span class="p">),</span> <span class="n">obs</span><span class="o">=</span><span class="n">hits</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">partially_pooled_with_logit</span><span class="p">(</span><span class="n">at_bats</span><span class="p">,</span> <span class="n">hits</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Number of hits has a Binomial distribution with a logit link function.</span>
<span class="sd">    The logits $\alpha$ for each player is normally distributed with the</span>
<span class="sd">    mean and scale parameters sharing a common prior.</span>

<span class="sd">    :param (jnp.DeviceArray) at_bats: Number of at bats for each player.</span>
<span class="sd">    :param (jnp.DeviceArray) hits: Number of hits for the given at bats.</span>
<span class="sd">    :return: Number of hits predicted by the model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">loc</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;loc&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">HalfCauchy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">num_players</span> <span class="o">=</span> <span class="n">at_bats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">plate</span><span class="p">(</span><span class="s2">&quot;num_players&quot;</span><span class="p">,</span> <span class="n">num_players</span><span class="p">):</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Binomial</span><span class="p">(</span><span class="n">at_bats</span><span class="p">,</span> <span class="n">logits</span><span class="o">=</span><span class="n">alpha</span><span class="p">),</span> <span class="n">obs</span><span class="o">=</span><span class="n">hits</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">run_inference</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">at_bats</span><span class="p">,</span> <span class="n">hits</span><span class="p">,</span> <span class="n">rng_key</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">algo</span> <span class="o">==</span> <span class="s2">&quot;NUTS&quot;</span><span class="p">:</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="n">NUTS</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">algo</span> <span class="o">==</span> <span class="s2">&quot;HMC&quot;</span><span class="p">:</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="n">HMC</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">algo</span> <span class="o">==</span> <span class="s2">&quot;SA&quot;</span><span class="p">:</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="n">SA</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">mcmc</span> <span class="o">=</span> <span class="n">MCMC</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">num_warmup</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_chains</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">num_chains</span><span class="p">,</span>
                <span class="n">progress_bar</span><span class="o">=</span><span class="kc">False</span> <span class="k">if</span> <span class="p">(</span>
                    <span class="s2">&quot;NUMPYRO_SPHINXBUILD&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">disable_progbar</span><span class="p">)</span> <span class="k">else</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">mcmc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">rng_key</span><span class="p">,</span> <span class="n">at_bats</span><span class="p">,</span> <span class="n">hits</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mcmc</span><span class="o">.</span><span class="n">get_samples</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">at_bats</span><span class="p">,</span> <span class="n">hits</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">rng_key</span><span class="p">,</span> <span class="n">player_names</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">header</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; - TRAIN&#39;</span> <span class="k">if</span> <span class="n">train</span> <span class="k">else</span> <span class="s1">&#39; - TEST&#39;</span><span class="p">)</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">Predictive</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">posterior_samples</span><span class="o">=</span><span class="n">z</span><span class="p">)(</span><span class="n">rng_key</span><span class="p">,</span> <span class="n">at_bats</span><span class="p">)[</span><span class="s1">&#39;obs&#39;</span><span class="p">]</span>
    <span class="n">print_results</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">+</span> <span class="n">header</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">30</span><span class="p">,</span>
                  <span class="n">predictions</span><span class="p">,</span>
                  <span class="n">player_names</span><span class="p">,</span>
                  <span class="n">at_bats</span><span class="p">,</span>
                  <span class="n">hits</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">train</span><span class="p">:</span>
        <span class="n">post_loglik</span> <span class="o">=</span> <span class="n">log_likelihood</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">at_bats</span><span class="p">,</span> <span class="n">hits</span><span class="p">)[</span><span class="s1">&#39;obs&#39;</span><span class="p">]</span>
        <span class="c1"># computes expected log predictive density at each data point</span>
        <span class="n">exp_log_density</span> <span class="o">=</span> <span class="n">logsumexp</span><span class="p">(</span><span class="n">post_loglik</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">post_loglik</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># reports log predictive density of all test points</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Log pointwise predictive density: </span><span class="si">{:.2f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exp_log_density</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>


<span class="k">def</span> <span class="nf">print_results</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">player_names</span><span class="p">,</span> <span class="n">at_bats</span><span class="p">,</span> <span class="n">hits</span><span class="p">):</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;At-bats&#39;</span><span class="p">,</span> <span class="s1">&#39;ActualHits&#39;</span><span class="p">,</span> <span class="s1">&#39;Pred(p25)&#39;</span><span class="p">,</span> <span class="s1">&#39;Pred(p50)&#39;</span><span class="p">,</span> <span class="s1">&#39;Pred(p75)&#39;</span><span class="p">]</span>
    <span class="n">header_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt;20}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1">&#39;</span>
    <span class="n">row_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt;20}</span><span class="s1"> </span><span class="si">{:&gt;10.0f}</span><span class="s1"> </span><span class="si">{:&gt;10.0f}</span><span class="s1"> </span><span class="si">{:&gt;10.2f}</span><span class="s1"> </span><span class="si">{:&gt;10.2f}</span><span class="s1"> </span><span class="si">{:&gt;10.2f}</span><span class="s1">&#39;</span>
    <span class="n">quantiles</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">header_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">columns</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">player_names</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">row_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">at_bats</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">hits</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">*</span><span class="n">quantiles</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">fetch_train</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="n">BASEBALL</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">player_names</span> <span class="o">=</span> <span class="n">fetch_train</span><span class="p">()</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">fetch_test</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="n">BASEBALL</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">test</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">fetch_test</span><span class="p">()</span>
    <span class="n">at_bats</span><span class="p">,</span> <span class="n">hits</span> <span class="o">=</span> <span class="n">train</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">train</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">season_at_bats</span><span class="p">,</span> <span class="n">season_hits</span> <span class="o">=</span> <span class="n">test</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">test</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">((</span><span class="n">fully_pooled</span><span class="p">,</span>
                               <span class="n">not_pooled</span><span class="p">,</span>
                               <span class="n">partially_pooled</span><span class="p">,</span>
                               <span class="n">partially_pooled_with_logit</span><span class="p">,</span>
                               <span class="p">)):</span>
        <span class="n">rng_key</span><span class="p">,</span> <span class="n">rng_key_predict</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">zs</span> <span class="o">=</span> <span class="n">run_inference</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">at_bats</span><span class="p">,</span> <span class="n">hits</span><span class="p">,</span> <span class="n">rng_key</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="n">predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">at_bats</span><span class="p">,</span> <span class="n">hits</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">rng_key_predict</span><span class="p">,</span> <span class="n">player_names</span><span class="p">)</span>
        <span class="n">predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">season_at_bats</span><span class="p">,</span> <span class="n">season_hits</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">rng_key_predict</span><span class="p">,</span> <span class="n">player_names</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">__version__</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;0.3.0&#39;</span><span class="p">)</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Baseball batting average using HMC&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-n&quot;</span><span class="p">,</span> <span class="s2">&quot;--num-samples&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--num-warmup&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--num-chains&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--algo&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;NUTS&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;whether to run &quot;HMC&quot;, &quot;NUTS&quot;, or &quot;SA&quot;&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-dp&#39;</span><span class="p">,</span> <span class="s1">&#39;--disable-progbar&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;whether to disable progress bar&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--device&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;use &quot;cpu&quot; or &quot;gpu&quot;.&#39;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">numpyro</span><span class="o">.</span><span class="n">set_platform</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
    <span class="n">numpyro</span><span class="o">.</span><span class="n">set_host_device_count</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">num_chains</span><span class="p">)</span>

    <span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  30.819 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-baseball-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/f9c0ac7f5dc10db8d41a45fdefff904c/baseball.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">baseball.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/04d76a0232052f005dfa9db0669310fc/baseball.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">baseball.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bnn.html" class="btn btn-neutral float-right" title="Bayesian Neural Network" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Code Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, Uber Technologies, Inc

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>